<html metal:use-macro="here/main_template/macros/page">
    <script  metal:fill-slot="script" tal:content="python:'function init(){OnBodyLoad(\'tid\',\'tid\');}'"/>
    <div align="justify" metal:fill-slot="error" class="error" tal:condition="request/err|options/err|nothing" tal:content="structure request/err|options/err"/>
    <div aling="justify" tal:condition="request/warn|options/warn|nothing" tal:content="structure request/warn|options/warn" />
    <div metal:fill-slot="data" align="center" style="font-size:11px">
    <div id="errorblock" class="error"></div>
    <script language="javascript">
     function submit_all(){
     if (document.getElementById('errorblock').innerHTML != '') 
	{
         document.getElementById('finish').href = '#';
         return false;
        }
     document.getElementById('errorblock').innerHTML = 'Дождитесь выполнения операции для продолжения работы'; 
     }
    </script>
    <form action='taskAction'>
        Отсканируйте ШК тележки:<br>
        <input type='text' name='tid' id='tid' maxlength="127">
        <input type='hidden' name='uid' tal:attributes='value request/uid'>
        <input type='hidden' name='id_site' tal:attributes='value options/id_site'>
        <input type='hidden' name='id_shtask' tal:attributes='value options/id_shtask'>
    </form>
    
    <br>
    <span tal:condition="python: options.get('oplist') != None">
        <table bgcolor="#ffffff" border='0' cellspacing=1>
            <tr class="tabcaption">
                <td width="100">Документ</td>
                <td width="100">Тележек</td>
            </tr>
            <span tal:repeat="item python: options['oplist']">
                <tr bgcolor="#000000" align="center">
                    <td><a tal:attributes="href python: 'taskAction?uid=%s&id_site=%s&opid=%s&id_shtask=%s&opnumber=%s' % (request.uid, options.get('id_site'), item.ID_OP, options.get('id_shtask'), item.OPNUMBER)" tal:content="item/OPNUMBER" /></td>  
                    <td tal:content="item/COUNTTEL"></td>
                </tr>
            </span>
        </table>
    </span>
    
    <br>
    <br><a id='back' tal:attributes="href python: 'gettelegaAction?uid=%s&id_site=%s&id_shtask_main=%s&outurl=%s&tcode=IMPORT_PAL'%(request.uid, options.get('id_site'), options.get('id_shtask'), options.get('outurl'))">Определение ШК тележки</a>
    <br><a id='finish' onClick='submit_all();' tal:attributes="href python: 'taskAction?uid=%s&id_site=%s&endflag=true&id_shtask=%s'%(request.uid, options.get('id_site'), options.get('id_shtask'))">Завершить приемку</a>
    <br><a id='route' onClick='submit_all();' tal:attributes="href python: 'routeAction?uid=%s&id_site=%s&id_shtask=%s&act=start'%(request.uid, options.get('id_site'), options.get('id_shtask'))">Информация о приходе</a>
    <br><a id='back' tal:attributes="href python: '../taskListAction?uid=%s&exit=true'%(request.uid)">Выход в главное меню</a>
    </div> 
</html>