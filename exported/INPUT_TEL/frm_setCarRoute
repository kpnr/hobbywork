<html metal:use-macro="here/main_template/macros/page">
    <script  metal:fill-slot="script" tal:content="python:'function init(){OnBodyLoad(\'tid\',\'tid\');}'"/>
    <div align="justify" metal:fill-slot="error" class="error" tal:condition="request/err|options/err|nothing" tal:content="structure request/err|options/err"/>
    <div aling="justify" tal:condition="request/warn|options/warn|nothing" tal:content="structure request/warn|options/warn" />
    <div metal:fill-slot="data" align="center" style="font-size:11px">
    <div id="errorblock" class="error"></div>
    <script language="javascript">
     function submit_all(){
     if (document.getElementById('errorblock').innerHTML != '') 
	{
         document.getElementById('finish').href = '#';
         return false;
        }
     document.getElementById('errorblock').innerHTML = 'Дождитесь выполнения операции для продолжения работы'; 
     }
    </script>
    <form action='routeAction'>
        Отсканируйте ШК тележки для завершения<br>
        <input type='text' name='tid' id='tid' maxlength="127">
        <input type='hidden' name='uid' tal:attributes='value request/uid'>
        <input type='hidden' name='id_site' tal:attributes='value options/id_site'>
        <input type='hidden' name='id_shtask' tal:attributes='value options/id_shtask'>
        <input type='hidden' name='act' value='scan2'>
        <input type='hidden' name='id_route' tal:attributes="value python: options['route_list'][0]['ID_ROUTE']">
    </form>    
    <br>
    <br> 
    <span style="font-size:14px" tal:condition="python: options.get('route_list') != None">
        Номер маршрута: <span tal:content="python: options['route_list'][0]['ID_ROUTE']"></span>
        <table bgcolor="#ffffff" border='0' cellspacing=1 style="font-size:12px">
            <tr class="tabcaption">
                <td width="100">Дата приезда</td>
                <td width="100">Дата отъезда</td>
            </tr>
            <span tal:repeat="item python: options['route_list']">
                <tr bgcolor="#000000" align="center">
                    <td tal:content="item/DATE_IN"></td>  
                    <td tal:content="item/DATE_OUT"></td>
                </tr>
            </span>
        </table>
    </span>    
    <br>
    <br>
    <span tal:condition="python: options['route_list'][0]['DATE_OUT'] != None">
    <a id='end' onClick='submit_all();' tal:attributes="href python: 'routeAction?uid=%s&tid=%s&id_site=%s&act=setdateout&id_shtask=%s&id_route=%s&date_out=%s'%(request.uid, request.tid, options.get('id_site'), options.get('id_shtask'),request.id_route,options['route_list'][0]['DATE_OUT'])">Подтвердить отъезд</a>
    <br>
    </span>
    <a id='index' tal:attributes="href python: 'routeAction?uid=%s&id_site=%s&act=start&id_shtask=%s'%(request.uid, options.get('id_site'), options.get('id_shtask'))">Назад</a>
    </div> 
</html>