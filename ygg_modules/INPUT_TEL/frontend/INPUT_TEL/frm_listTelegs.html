{%- extends "zope/main_template.html" -%}
{%- block script -%}
  <script>
    {{ 'function init(){OnBodyLoad(\'tovarid\',\'tovarid\');}' }}
  </script>
{%- endblock -%}

{%- block error -%}
  {%- if request.err or options.err or nothing -%}
    <div align="justify" class="error">
      {{ request.err or options.err }}
    </div>
  {%- endif -%}
{%- endblock -%}

{%- block data -%}
  <div align="center" style="font-size:11px">
    <b>
      Определение № тележки.
    </b>
    <br />
    <form action="gettelegaAction">
      Отсканируйте товары, лежащие на тележке:
      <br />
      <input type="text" name="tovarid" id="tovarid" maxlength="40" />
      <input type="hidden" name="uid" value="{{ request.uid }}" />
      <input type="hidden" name="outurl" value="{{ request.outurl }}" />
      <input type="hidden" name="tcode" value="{{ options.tcode }}" />
      <input type="hidden" name="id_shtask" value="{{ options.id_shtask }}" />
    </form>
    {%- if python: options.get('currenttovar') is not None  -%}
      <span>
        <br />
        Отсканировано товаров:
        <span>
          {{ options.totalcnt }}
        </span>
        шт.
        <br />
        <br />
        <b>
          <span>
            {{ options.currenttovar }}
          </span>
        </b>
        <br />
        <br />
      </span>
    {%- endif -%}
    {%- if python: options.get('alltovar') is not None -%}
      <span>
        Список вероятных номеров тележек:
        <br />
        <table bgcolor="#ffffff" border="0" cellspacing="1">
          <tr class="tabcaption" align="center">
            <td width="90px">
              Тел/Опер/Дата
            </td>
            <td width="60px">
              Совпало
            </td>
            <td width="60px">
              Не совпало
            </td>
          </tr>
          {%- for item in python: options['alltovar'] -%}
            <span>
              <tr bgcolor="#000000" align="center">
                <td>
                  <a href="{{ 'gettelegaAction?act=viewtelega&uid=%s&tid=%s&id_shtask=%s&outurl=%s&tcode=%s&tnumber=%s' % (request.uid, item.ID_SHTASK, options.get('id_shtask'), request.get('outurl'), options.get('tcode'), item.NUMBER) }}">
                    {{ item.NUMBER }}
                  </a>
                  <br />
                  <span>
                    {{ item['op_number'] }}
                  </span>
                  <br />
                  <span>
                    {{ item['op_date'] }}
                  </span>
                </td>
                <td>
                  {{ item.COUNTS }}
                </td>
                <td>
                  {{ item.COUNTNS }}
                </td>
              </tr>
            </span>
          {%- endfor -%}
        </table>
      </span>
    {%- endif -%}
    <br />
    <br />
    <a id="back" href="{{ '%s&cleansearch=1&cleanshtask=%s'%(request.outurl.decode('base64'), options.get('id_shtask')) }}">
      Назад
    </a>
  </div>
{%- endblock -%}

