{%- extends "zope/main_template.html" -%}
{%- block script -%}
  <script>
    {{ 'function init(){OnBodyLoad(\'tid\',\'tid\');}' }}
  </script>
{%- endblock -%}

{%- block error -%}
  {%- if request.err or options.err or nothing -%}
    <div align="justify" class="error">
      {{ request.err or options.err }}
    </div>
  {%- endif -%}
{%- endblock -%}

{%- block data -%}
  <div align="center" style="font-size:11px">
    <div id="errorblock" class="error" />
    <script language="javascript">
      function submit_all(){
     if (document.getElementById('errorblock').innerHTML != '') 
	{
         document.getElementById('finish').href = '#';
         return false;
        }
     document.getElementById('errorblock').innerHTML = 'Дождитесь выполнения операции для продолжения работы'; 
     }
    </script>
    <form action="taskAction">
      Отсканируйте ШК тележки:
      <br />
      <input type="text" name="tid" id="tid" maxlength="127" />
      <input type="hidden" name="uid" value="{{ request.uid }}" />
      <input type="hidden" name="id_shtask" value="{{ options.id_shtask }}" />
      <input type="hidden" name="id_site" value="{{ options.id_site }}" />
    </form>
    <br />
    {%- if python: options.get('oplist') != None -%}
      <span>
        <table bgcolor="#ffffff" border="0" cellspacing="1">
          <tr class="tabcaption">
            <td width="100">
              Документ
            </td>
            <td width="100">
              Тележек
            </td>
          </tr>
          {%- for item in python: options['oplist'] -%}
            <span>
              <tr bgcolor="#000000" align="center">
                <td>
                  <a href="{{ 'taskAction?uid=%s&id_site=%s&opid=%s&id_shtask=%s&opnumber=%s' % (request.uid, options.get('id_site'), item.ID_OP, options.get('id_shtask'), item.OPNUMBER) }}">
                    {{ item.OPNUMBER }}
                  </a>
                </td>
                <td>
                  {{ item.COUNTTEL }}
                </td>
              </tr>
            </span>
          {%- endfor -%}
        </table>
      </span>
    {%- endif -%}
    <br />
    <br />
    <a id="back" href="{{ 'gettelegaAction?uid=%s&id_site=%s&id_shtask_main=%s&outurl=%s&tcode=IMPORT_PAL'%(request.uid, options.get('id_site'), options.get('id_shtask'), options.get('outurl')) }}">
      Определение ШК тележки
    </a>
    <br />
    <a id="finish" onclick="submit_all();" href="{{ 'taskAction?uid=%s&id_site=%s&endflag=true&id_shtask=%s'%(request.uid, options.get('id_site'), options.get('id_shtask')) }}">
      Завершить приемку
    </a>
    <br />
    <a id="route" onclick="submit_all();" href="{{ 'routeAction?uid=%s&id_site=%s&id_shtask=%s&act=start'%(request.uid, options.get('id_site'), options.get('id_shtask')) }}">
      Информация о приходе
    </a>
    <br />
    <a id="back" href="{{ '../taskListAction?uid=%s&exit=true'%(request.uid) }}">
      Выход в главное меню
    </a>
  </div>
{%- endblock -%}

